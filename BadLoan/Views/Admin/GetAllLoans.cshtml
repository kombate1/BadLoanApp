@using System.Globalization
@model IEnumerable<BadLoan.Models.LoanApplication>

@{
    ViewData["Title"] = "Loan Applications";
    string GetBadgeClass(string status) => status.ToLower() switch
    {
        "pending" => "badge bg-warning text-dark",
        "approved" => "badge bg-success",
        "rejected" => "badge bg-danger",
        "under review" => "badge bg-primary",
        _ => "badge bg-secondary"
    };
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Loan Applications</h2>
        <span class="text-muted">@Model.Count() applications</span>
    </div>

    <div class="d-flex mb-3">
        <input type="text" class="form-control me-2" placeholder="Search applications..." />
        <select class="form-select" style="max-width: 200px;">
            <option selected>All Status</option>
            <option>Pending</option>
            <option>Approved</option>
            <option>Rejected</option>
        </select>
    </div>


    <table class="table align-middle table-hover">
        <thead class="table-light">
            <tr>
                <th>Customer</th>
                <th>Amount</th>
                <th>Purpose</th>
                <th>Status</th>
                <th>Credit Score</th>
                <th>Submitted</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var app in Model)
            {
                <tr>
                    <td>
                        <strong>@app.Customer?.FirstName @app.Customer?.LastName</strong><br />
                        @* <small class="text-muted">@app.Customer?.Email</small> *@
                    </td>
                    <td>@app.LoanAmount.ToString("C0", new CultureInfo("en-US"))</td>
                    <td>@app.LoanType?.LoanTypeName</td>
                    <td>
                        <span class="@GetBadgeClass(app.Status)">
                            @app.Status.ToLower()
                        </span>
                    </td>
                    @* <td>@app.CreditScore</td>
                    <td>@app.SubmissionDate.ToString("MMM dd, yyyy")</td> *@
                    <td>
                        <a asp-controller="LoanApplication" asp-action="Details" asp-route-id="@app.Id" class="text-primary me-2" title="View">
                            <i class="bi bi-eye"></i>
                        </a>
                        @if (app.Status == "pending")
                        {
                            <a asp-action="GetPendingLoans" asp-route-id="@app.Id" class="text-success me-2" title="Approve">
                                <i class="bi bi-check-circle"></i>
                            </a>
                            <a asp-action="GetRejectedLoans" asp-route-id="@app.Id" class="text-danger" title="Reject">
                                <i class="bi bi-x-circle"></i>
                            </a>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
